<%= turbo_stream_from @answer %>
<div class="h-screen flex flex-col" data-controller="code-editor" >
  <div class="flex justify-between p-2 border">
    <div class="text-sm flex items-center justify-center">
      <%= @exam.test_position(@test) %> / <%= @exam.total_tests %>
    </div>
    <div class="flex justify-end gap-2">
      <%= render partial: "actions", locals: {exam: @exam, test: @test} %>
    </div>
  </div>
  <div class="flex h-full flex-1">
    <div class="w-2/6 px-4">
      <div class="py-4 text-sm">
        <div class="mb-4 flex justify-between items-center">
          <%= @test.title %>
          <%= form_with model: @answer, url: answer_language_path(answer_id: @answer.id), data: { "code-editor-target": "languageForm" } do |f| %>
            <div class="relative">
              <%= f.select :language, @test.available_languages, {}, class: "pl-4 pr-10 py-2 border rounded appearance-none", data: { "code-editor-target": "languageSwitcher", "action": "change->code-editor#switchLanguage" } %>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 absolute" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="top: 50%; right: 0;transform: translate(-50%, -50%);">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
              </svg>
            </div>
          <% end %>
        </div>
        <div class="markdown-body text-sm"><%= markdown(@test.description) %></div>
      </div>
    </div>
    <div class="w-4/6" data-action="resize@window->code-editor#resizeCodeEditor">
      <div id="code-editor-status" data-code-editor-target="status" class="text-xs bg-gray-200 py-2 px-4 absolute right-0 z-50">
        Saved
      </div>
      <div class="flex flex-col border-l justify-between h-full">
        <%= form_with model: @answer, url: answer_path(@answer), authenticity_token: false, method: :patch, id: "answer-form", class: "h-4/6", data: {'code-editor-target': 'form'} do |f| %>
          <%= f.hidden_field :language, data: { "code-editor-target": "answerLanguage" } %>
          <%= f.text_area :answer, id: "code-editor", class: "p-4 w-full mb-4", rows: 15 %>
        <% end %>
        <div class="h-2/6 shrink-0 border-t bg-gray-800 text-white overflow-auto" id="code-runner" data-code-editor-target="output">
          <%= button_to exam_test_run_path(exam_id: @exam, test_id: @test), class: "btn btn-primary absolute right-0 m-4", data: { "turbo-method": "post" } do %>
            <span class="show-when-enabled">Run</span>
            <span class="show-when-disabled">Running...</span>
          <% end %>
          <div id="code-runner-output" class="mardown-body text-xs p-4">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
